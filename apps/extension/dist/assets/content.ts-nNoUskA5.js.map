{"version":3,"file":"content.ts-nNoUskA5.js","sources":["../../src/scheduler.ts","../../src/extract.ts","../../src/toast.ts","../../src/content.ts"],"sourcesContent":["export function planChecks(durationMs: number, n: number): number[] {\n  const slots = Array.from({ length: n }, (_, i) => (i + 0.5) * durationMs / n)\n  return slots\n    .map(t => t + (Math.random() - 0.5) * (durationMs / n) * 0.4) // �}20% jitter\n    .map(t => Math.max(0, Math.min(durationMs - 1000, t)))\n    .sort((a, b) => a - b)\n}\n\nexport function watchNavChanges(cb: () => void, opts?: { minIntervalMs?: number; pollMs?: number }) {\n  const minInterval = opts?.minIntervalMs ?? 15_000\n  const pollMs = opts?.pollMs ?? 5_000\n  let lastFire = 0\n  let lastURL = location.href\n  let lastTitle = document.title\n\n  const timer = window.setInterval(() => {\n    const now = Date.now()\n    const changed = (location.href !== lastURL) || (document.title !== lastTitle)\n    if (changed && (now - lastFire >= minInterval)) {\n      lastURL = location.href\n      lastTitle = document.title\n      lastFire = now\n      try { cb() } catch (e) { console.warn(\"[FocusGuard] nav cb error\", e) }\n    }\n  }, pollMs)\n\n  return () => window.clearInterval(timer)\n}\r\n","export async function waitStableDOM(timeout = 5000): Promise<void> {\r\n  return new Promise((resolve) => {\r\n    let settleTimer: number | undefined;\r\n\r\n    const armSettle = () => {\r\n      if (settleTimer) clearTimeout(settleTimer);\r\n      settleTimer = window.setTimeout(() => {\r\n        obs.disconnect();\r\n        resolve();\r\n      }, 300);\r\n    };\r\n\r\n    const obs = new MutationObserver(() => {\r\n      armSettle(); \r\n    });\r\n\r\n    obs.observe(document.documentElement, {\r\n      childList: true,\r\n      subtree: true,\r\n    });\r\n\r\n    armSettle();\r\n\r\n    window.setTimeout(() => {\r\n      if (settleTimer) clearTimeout(settleTimer);\r\n      obs.disconnect();\r\n      resolve();\r\n    }, timeout);\r\n  });\r\n}\r\n\r\n\r\nfunction getMeta(name: string): string {\r\n  return (\r\n    document.querySelector(`meta[name=\"${name}\"]`)?.getAttribute(\"content\") ||\r\n    document.querySelector(`meta[property=\"${name}\"]`)?.getAttribute(\"content\") ||\r\n    \"\"\r\n  )\r\n}\r\n\r\nfunction getJsonLd(): string {\r\n  const scripts = Array.from(document.querySelectorAll('script[type=\"application/ld+json\"]'))\r\n  const parts: string[] = []\r\n  for (const s of scripts) {\r\n    const t = s.textContent || \"\"\r\n    if (t) parts.push(t.slice(0, 4000))\r\n  }\r\n  return parts.join(\"\\n\")\r\n}\r\n\r\nexport async function extractMinimum() {\r\n  await waitStableDOM()\r\n\r\n  const title = document.title || getMeta(\"og:title\") || getMeta(\"twitter:title\")\r\n  const description = getMeta(\"description\") || getMeta(\"og:description\") || getMeta(\"twitter:description\")\r\n  const jsonld = getJsonLd()\r\n  const main = document.querySelector(\"article, main\")?.textContent?.trim() ?? \"\"\r\n  const snippet = main.slice(0, 600)\r\n\r\n  return {\r\n    url: location.href,\r\n    domain: location.hostname,\r\n    title: title || undefined,\r\n    description: description || undefined,\r\n    snippet: snippet || undefined,\r\n    jsonld: jsonld || undefined\r\n  }\r\n}\r\n","// toast.ts (robust, Shadow DOM, single-instance, high z-index)\r\n// API: showToast(message, actions, opts?)\r\n\r\nexport type ToastAction = {\r\n  label: string;\r\n  danger?: boolean;\r\n  onClick?: () => void;\r\n};\r\n\r\ntype ToastOpts = {\r\n  durationMs?: number; // auto-hide; if undefined, persistent\r\n};\r\n\r\nlet host: HTMLElement | null = null;\r\nlet shadow: ShadowRoot | null = null;\r\nlet currentToast: HTMLElement | null = null;\r\n\r\n// Ensure a shadow host attached to <html> so page CSS can't override us.\r\nfunction ensureShadowHost() {\r\n  if (host && shadow) return;\r\n  host = document.getElementById(\"fg-toast-host\") as HTMLElement | null;\r\n  if (!host) {\r\n    host = document.createElement(\"div\");\r\n    host.id = \"fg-toast-host\";\r\n    // Position host at top-level; pointer-events: none so only toast handles events\r\n    Object.assign(host.style, {\r\n      position: \"fixed\",\r\n      inset: \"0\",\r\n      pointerEvents: \"none\",\r\n      zIndex: \"2147483647\", // max 32-bit int\r\n    } as CSSStyleDeclaration);\r\n    document.documentElement.appendChild(host);\r\n  }\r\n  if (!host.shadowRoot) {\r\n    shadow = host.attachShadow({ mode: \"open\" });\r\n    const style = document.createElement(\"style\");\r\n    style.textContent = `\r\n      :host { all: initial; }\r\n      /* Container that holds the toast (top-right) */\r\n      .fg-wrap {\r\n        position: fixed;\r\n        top: 16px;\r\n        right: 16px;\r\n        left: auto;\r\n        bottom: auto;\r\n        display: flex;\r\n        flex-direction: column;\r\n        gap: 8px;\r\n        pointer-events: none; /* children enable */\r\n        z-index: 1;\r\n      }\r\n      .fg-toast {\r\n        pointer-events: auto;\r\n        min-width: 260px;\r\n        max-width: min(480px, 92vw);\r\n        background: rgba(28,28,31,0.96);\r\n        color: #fff;\r\n        border-radius: 12px;\r\n        box-shadow: 0 10px 30px rgba(0,0,0,.35);\r\n        overflow: hidden;\r\n        font: 14px/1.45 system-ui, -apple-system, \"Segoe UI\", Roboto, Arial, sans-serif;\r\n        border: 1px solid rgba(255,255,255,0.08);\r\n        transform: translateY(-6px);\r\n        opacity: 0;\r\n        animation: fg-enter 160ms ease-out forwards;\r\n      }\r\n      @keyframes fg-enter { to { transform: translateY(0); opacity: 1; } }\r\n      .fg-row {\r\n        display: grid;\r\n        grid-template-columns: 1fr auto;\r\n        align-items: start;\r\n        gap: 8px;\r\n        padding: 12px 12px 8px 12px;\r\n      }\r\n      .fg-msg {\r\n        white-space: pre-wrap;\r\n        word-break: break-word;\r\n      }\r\n      .fg-x {\r\n        background: transparent;\r\n        border: 0;\r\n        color: #cfcfd2;\r\n        font: inherit;\r\n        cursor: pointer;\r\n        padding: 2px 6px;\r\n        border-radius: 6px;\r\n      }\r\n      .fg-x:hover { color: #fff; background: rgba(255,255,255,0.08); }\r\n      .fg-actions {\r\n        display: flex;\r\n        gap: 8px;\r\n        padding: 0 12px 12px 12px;\r\n        flex-wrap: wrap;\r\n      }\r\n      .fg-btn {\r\n        border: 0;\r\n        border-radius: 8px;\r\n        padding: 8px 12px;\r\n        cursor: pointer;\r\n        background: #2b2b30;\r\n        color: #fff;\r\n      }\r\n      .fg-btn:hover { background: #3a3a41; }\r\n      .fg-btn.fg-danger { background: #c6362b; }\r\n      .fg-btn.fg-danger:hover { background: #b02e25; }\r\n      @media (max-width: 560px) {\r\n        .fg-wrap { right: 8px; top: 8px; }\r\n        .fg-toast { min-width: 220px; }\r\n      }\r\n    `;\r\n    const wrap = document.createElement(\"div\");\r\n    wrap.className = \"fg-wrap\";\r\n    shadow!.append(style, wrap);\r\n  } else {\r\n    shadow = host.shadowRoot!;\r\n  }\r\n}\r\n\r\nfunction disposeCurrent() {\r\n  if (currentToast) {\r\n    try { currentToast.remove(); } catch {}\r\n    currentToast = null;\r\n  }\r\n}\r\n\r\nexport function showToast(message: string, actions: ToastAction[], opts?: ToastOpts) {\r\n  try {\r\n    ensureShadowHost();\r\n    const wrap = shadow!.querySelector(\".fg-wrap\") as HTMLElement;\r\n    if (!wrap) return;\r\n\r\n    // Single-instance: remove previous toast\r\n    disposeCurrent();\r\n\r\n    const root = document.createElement(\"div\");\r\n    root.className = \"fg-toast\";\r\n\r\n    const row = document.createElement(\"div\");\r\n    row.className = \"fg-row\";\r\n\r\n    const msg = document.createElement(\"div\");\r\n    msg.className = \"fg-msg\";\r\n    msg.textContent = message;\r\n\r\n    const x = document.createElement(\"button\");\r\n    x.className = \"fg-x\";\r\n    x.setAttribute(\"aria-label\", \"Close\");\r\n    x.textContent = \"×\";\r\n    x.addEventListener(\"click\", () => disposeCurrent());\r\n\r\n    row.append(msg, x);\r\n\r\n    const actBar = document.createElement(\"div\");\r\n    actBar.className = \"fg-actions\";\r\n\r\n    const onClickWrapper = (fn?: () => void) => () => {\r\n      try { fn && fn(); } catch {}\r\n      disposeCurrent();\r\n    };\r\n\r\n    (actions || []).slice(0, 3).forEach((a) => {\r\n      const b = document.createElement(\"button\");\r\n      b.className = \"fg-btn\" + (a.danger ? \" fg-danger\" : \"\");\r\n      b.textContent = a.label || \"OK\";\r\n      b.addEventListener(\"click\", onClickWrapper(a.onClick));\r\n      actBar.appendChild(b);\r\n    });\r\n\r\n    root.append(row, actBar);\r\n    wrap.appendChild(root);\r\n    currentToast = root;\r\n\r\n    // Optional auto-hide\r\n    const dur = opts?.durationMs;\r\n    if (typeof dur === \"number\" && isFinite(dur) && dur > 0) {\r\n      setTimeout(() => disposeCurrent(), dur);\r\n    }\r\n\r\n    // Debug hook\r\n    // eslint-disable-next-line no-console\r\n    console.log(\"[FG] toast shown:\", { message, actions: actions?.map(a => a.label) });\r\n  } catch (e) {\r\n    // As a last resort, use alert (should not happen)\r\n    // eslint-disable-next-line no-alert\r\n    alert(message);\r\n  }\r\n}\r\n","// content.ts\r\n// Session control, extraction -> /score (A) -> optional /judge (B), scheduler & nav-watch.\r\n// All network calls prefer SW-proxy (FG_FETCH_JSON) to avoid HTTPS→HTTP mixed-content blocks.\r\n// Falls back to direct fetch on HTTP pages. UI (toast) only for BLOCK/REVIEW.\r\n\r\nimport { planChecks, watchNavChanges } from \"./scheduler\";\r\nimport { extractMinimum } from \"./extract\";\r\nimport { showToast } from \"./toast\";\r\nimport type { FocusProfile, Judgment } from \"./types\";\r\n\r\nconst BACKEND = \"http://localhost:8787\";\r\nconst CHECK_MIN_INTERVAL_MS = 15_000;\r\n\r\nlet running = false;\r\nlet lastCheckAt = 0;\r\n\r\nlet judgeInFlight = false;\r\nlet judgeCooldownUntil = 0;\r\n\r\nlet stopWatchNav: (() => void) | null = null;\r\n\r\nconsole.log(\"[FG] content boot\");\r\n\r\n// ---------- session helpers ----------\r\nasync function sessionEndAt(): Promise<number | null> {\r\n  return new Promise((res) => {\r\n    chrome.storage.local.get([\"fg_session_endAt\"], (d) => {\r\n      const t = d?.fg_session_endAt;\r\n      res(typeof t === \"number\" ? t : null);\r\n    });\r\n  });\r\n}\r\nasync function sessionActive(): Promise<boolean> {\r\n  const t = await sessionEndAt();\r\n  return !!(t && t > Date.now());\r\n}\r\n\r\nasync function getSession(): Promise<{\r\n  minutes: number;\r\n  consent: boolean;\r\n  profile: FocusProfile;\r\n  goal: string;\r\n  endAt: number;\r\n} | null> {\r\n  return new Promise((resolve) => {\r\n    chrome.storage.local.get(\r\n      [\"fg_minutes\", \"fg_consent\", \"fg_profile\", \"fg_goal\", \"fg_session_endAt\"],\r\n      (data) => {\r\n        const p = data?.fg_profile as any;\r\n        const goal = typeof data?.fg_goal === \"string\" ? data.fg_goal.trim() : \"\";\r\n        const endAt = typeof data?.fg_session_endAt === \"number\" ? data.fg_session_endAt : 0;\r\n        if (!p || !Array.isArray(p.allow) || !Array.isArray(p.block) || !goal) {\r\n          return resolve(null);\r\n        }\r\n        if (!endAt || endAt <= Date.now()) return resolve(null);\r\n        resolve({\r\n          minutes: Number(data.fg_minutes) || 30,\r\n          consent: Boolean(data.fg_consent),\r\n          profile: { allow: p.allow, block: p.block },\r\n          goal,\r\n          endAt,\r\n        });\r\n      }\r\n    );\r\n  });\r\n}\r\n\r\nasync function getSettingsRaw(): Promise<{\r\n  minutes: number;\r\n  consent: boolean;\r\n  profile: FocusProfile;\r\n  goal: string;\r\n}> {\r\n  return new Promise((resolve) => {\r\n    chrome.storage.local.get([\"fg_minutes\", \"fg_consent\", \"fg_profile\", \"fg_goal\"], (data) => {\r\n      const p = (data?.fg_profile as any) || { allow: [], block: [] };\r\n      const goal = typeof data?.fg_goal === \"string\" ? data.fg_goal.trim() : \"\";\r\n      resolve({\r\n        minutes: Number(data?.fg_minutes) || 30,\r\n        consent: Boolean(data?.fg_consent),\r\n        profile: {\r\n          allow: Array.isArray(p.allow) ? p.allow : [],\r\n          block: Array.isArray(p.block) ? p.block : [],\r\n        },\r\n        goal,\r\n      });\r\n    });\r\n  });\r\n}\r\n\r\n// ---------- network helpers (SW-proxy first, direct-fetch fallback) ----------\r\ntype PostResp = { ok: boolean; status: number; data?: any; error?: string };\r\n\r\nfunction postViaSW(url: string, body: unknown, timeoutMs: number): Promise<PostResp> {\r\n  return new Promise((resolve) => {\r\n    const to = setTimeout(() => resolve({ ok: false, status: 0, error: \"timeout\" }), timeoutMs);\r\n    try {\r\n      chrome.runtime.sendMessage(\r\n        { type: \"FG_FETCH_JSON\", url, body },\r\n        (resp: PostResp | undefined) => {\r\n          clearTimeout(to);\r\n          resolve(resp || { ok: false, status: 0, error: \"no_response\" });\r\n        }\r\n      );\r\n    } catch (e) {\r\n      clearTimeout(to);\r\n      resolve({ ok: false, status: 0, error: String(e) });\r\n    }\r\n  });\r\n}\r\n\r\nasync function postDirect(url: string, body: unknown, timeoutMs: number): Promise<PostResp> {\r\n  const ctrl = new AbortController();\r\n  const t = window.setTimeout(() => ctrl.abort(), timeoutMs);\r\n  try {\r\n    const r = await fetch(url, {\r\n      method: \"POST\",\r\n      headers: { \"Content-Type\": \"application/json\" },\r\n      body: JSON.stringify(body),\r\n      signal: ctrl.signal,\r\n    });\r\n    const data = await r\r\n      .json()\r\n      .catch(() => ({}));\r\n    return { ok: r.ok, status: r.status, data };\r\n  } catch (e) {\r\n    return { ok: false, status: 0, error: String(e) };\r\n  } finally {\r\n    clearTimeout(t);\r\n  }\r\n}\r\n\r\nasync function postJSON(path: string, body: unknown, timeoutMs = 5500): Promise<PostResp> {\r\n  // Try SW proxy first (avoids HTTPS→HTTP mixed-content issues)\r\n  const viaSW = await postViaSW(`${BACKEND}${path}`, body, timeoutMs);\r\n  if (viaSW.ok || viaSW.status !== 0) return viaSW;\r\n  // Fallback to direct fetch (works on HTTP pages)\r\n  const direct = await postDirect(`${BACKEND}${path}`, body, timeoutMs);\r\n  return direct;\r\n}\r\n\r\n// ---------- main judge flow ----------\r\nasync function runCheck(profile: FocusProfile, consent: boolean, goal: string) {\r\n  if (!(await sessionActive())) {\r\n    console.log(\"[FG] runCheck abort: session inactive (endAt missing/expired)\");\r\n    return;\r\n  }\r\n\r\n  const now = Date.now();\r\n  if (now - lastCheckAt < CHECK_MIN_INTERVAL_MS) {\r\n    // rate limit: avoid spamming A/B\r\n    return;\r\n  }\r\n  lastCheckAt = now;\r\n\r\n  // Optional capture (stored by SW with TTL; not uploaded here)\r\n  if (consent) {\r\n    try {\r\n      await chrome.runtime.sendMessage({ type: \"CAPTURE_FOR_CHECK\" });\r\n    } catch {\r\n      /* ignore */\r\n    }\r\n  }\r\n\r\n  // Extract minimal page context\r\n  const norm = await extractMinimum();\r\n\r\n  // ---- A stage ----\r\n  let a: Judgment;\r\n  try {\r\n    const body = { norm, profile, intent: { goal } };\r\n    const resp = await postJSON(\"/score\", body, 5500);\r\n    if (!resp.ok) throw new Error(`HTTP ${resp.status} ${resp.error || \"\"}`);\r\n    a = resp.data as Judgment;\r\n  } catch {\r\n    a = {\r\n      verdict: \"REVIEW\",\r\n      confidence: 0.5,\r\n      categories: [],\r\n      reasons: [\"backend_error\"],\r\n      path: \"A\",\r\n    };\r\n  }\r\n\r\n  // A=ALLOW → no UI\r\n  if (a.verdict === \"ALLOW\") return;\r\n\r\n  // A=BLOCK → warn\r\n  if (a.verdict === \"BLOCK\") {\r\n    showToast(\"FocusGuard: This looks off-purpose. Stop now?\", [\r\n      { label: \"Stop\", danger: true, onClick: () => { location.href = \"about:blank\"; } },\r\n      { label: \"Continue\", onClick: () => {} },\r\n    ]);\r\n    return;\r\n  }\r\n\r\n  // ---- B stage (only when A=REVIEW) ----\r\n  if (judgeInFlight || Date.now() < judgeCooldownUntil) {\r\n    showToast(\"FocusGuard: Unsure if this fits your goal. Continue?\", [\r\n      { label: \"Continue\", onClick: () => {} },\r\n      { label: \"Stop\", danger: true, onClick: () => { location.href = \"about:blank\"; } },\r\n      { label: \"Snooze 5m\", onClick: () => { setTimeout(() => runCheck(profile, consent, goal), 5 * 60 * 1000); } },\r\n    ]);\r\n    return;\r\n  }\r\n\r\n  judgeInFlight = true;\r\n  let b: Judgment | null = null;\r\n  try {\r\n    const body = { norm, profile, intent: { goal }, aJudgment: a };\r\n    const resp = await postJSON(\"/judge\", body, 5000); // 5s SLA\r\n    if (!resp.ok) throw new Error(`HTTP ${resp.status} ${resp.error || \"\"}`);\r\n    b = resp.data as Judgment;\r\n  } catch {\r\n    b = {\r\n      verdict: \"REVIEW\",\r\n      confidence: 0.5,\r\n      categories: [],\r\n      reasons: [\"b_error\"],\r\n      path: \"B\",\r\n    };\r\n  } finally {\r\n    judgeInFlight = false;\r\n    judgeCooldownUntil = Date.now() + 15_000;\r\n  }\r\n\r\n  if (!b || b.verdict === \"ALLOW\") return;\r\n\r\n  if (b.verdict === \"BLOCK\") {\r\n    showToast(\"FocusGuard: This looks off-purpose. Stop now?\", [\r\n      { label: \"Stop\", danger: true, onClick: () => { location.href = \"about:blank\"; } },\r\n      { label: \"Continue\", onClick: () => {} },\r\n    ]);\r\n    return;\r\n  }\r\n\r\n  // B=REVIEW\r\n  showToast(\"FocusGuard: Unsure if this fits your goal. Continue?\", [\r\n    { label: \"Continue\", onClick: () => {} },\r\n    { label: \"Stop\", danger: true, onClick: () => { location.href = \"about:blank\"; } },\r\n    { label: \"Snooze 5m\", onClick: () => { setTimeout(() => runCheck(profile, consent, goal), 5 * 60 * 1000); } },\r\n  ]);\r\n}\r\n\r\n// ---------- session lifecycle ----------\r\nasync function startSession(\r\n  minutes: number,\r\n  profile: FocusProfile,\r\n  consent: boolean,\r\n  goal: string,\r\n  endAt: number\r\n) {\r\n  if (running) return;\r\n  running = true;\r\n  console.log(\"[FG] session start\", {\r\n    minutes,\r\n    consent,\r\n    allow: profile.allow,\r\n    block: profile.block,\r\n    goal,\r\n  });\r\n\r\n  chrome.runtime.sendMessage({ type: \"FG_SCHEDULE_SESSION_END\", endAt }).catch(() => {});\r\n\r\n  runCheck(profile, consent, goal).catch(() => {});\r\n\r\n  // schedule N checks over the session with jitter\r\n  const durationMs = Math.max(0, endAt - Date.now());\r\n  const N = Math.max(3, Math.floor((durationMs / 60_000) / 5) || 1);\r\n  const plan = planChecks(durationMs, N);\r\n  const t0 = Date.now();\r\n  for (const offset of plan) {\r\n    setTimeout(() => runCheck(profile, consent, goal), Math.max(0, t0 + offset - Date.now()));\r\n  }\r\n\r\n  if (stopWatchNav) {\r\n    try {\r\n      stopWatchNav();\r\n    } catch {}\r\n  }\r\n  stopWatchNav = watchNavChanges(() => runCheck(profile, consent, goal), {\r\n    minIntervalMs: CHECK_MIN_INTERVAL_MS,\r\n  });\r\n}\r\n\r\n// ---------- bootstrap & listeners ----------\r\n(async () => {\r\n  try {\r\n    await chrome.runtime.sendMessage({ type: \"PING\" }).catch(() => undefined);\r\n\r\n    const sess = await getSession();\r\n    if (sess) startSession(sess.minutes, sess.profile, sess.consent, sess.goal, sess.endAt);\r\n\r\n    chrome.storage.onChanged.addListener((changes, area) => {\r\n      if (area !== \"local\") return;\r\n      if (\r\n        \"fg_minutes\" in changes ||\r\n        \"fg_profile\" in changes ||\r\n        \"fg_consent\" in changes ||\r\n        \"fg_goal\" in changes ||\r\n        \"fg_session_endAt\" in changes\r\n      ) {\r\n        getSession().then((s) => {\r\n          if (!s) {\r\n            if (running && \"fg_session_endAt\" in changes) {\r\n              running = false;\r\n              if (stopWatchNav) {\r\n                try {\r\n                  stopWatchNav();\r\n                } catch {}\r\n                stopWatchNav = null;\r\n              }\r\n              chrome.runtime.sendMessage({ type: \"FG_CANCEL_SESSION_END\" }).catch(() => {});\r\n            }\r\n            return;\r\n          }\r\n          if (!running) startSession(s.minutes, s.profile, s.consent, s.goal, s.endAt);\r\n        });\r\n      }\r\n    });\r\n  } catch (e) {\r\n    console.warn(\"[FG] content init error\", e);\r\n  }\r\n})();\r\n\r\n// Respond to FG_FORCE_CHECK and session-finish events\r\nchrome.runtime.onMessage.addListener((msg, _sender, sendResponse) => {\r\n  if (msg?.type === \"FG_FORCE_CHECK\") {\r\n    console.log(\"[FG] got FG_FORCE_CHECK\");\r\n    getSession().then((s) => {\r\n      if (!s) {\r\n        console.warn(\"[FG] no active session (fg_session_endAt missing/expired).\");\r\n        sendResponse({ ok: false, reason: \"no_active_session\" });\r\n        return;\r\n      }\r\n      runCheck(s.profile, s.consent, s.goal)\r\n        .then(() => sendResponse({ ok: true }))\r\n        .catch((e) => {\r\n          console.warn(\"[FG] runCheck error\", e);\r\n          sendResponse({ ok: false, error: String(e) });\r\n        });\r\n    });\r\n    return true; // async sendResponse\r\n  }\r\n\r\n  if (msg?.type === \"FG_SESSION_FINISHED\") {\r\n    running = false;\r\n    if (stopWatchNav) {\r\n      try {\r\n        stopWatchNav();\r\n      } catch {}\r\n      stopWatchNav = null;\r\n    }\r\n\r\n    chrome.storage.local.remove([\"fg_session_endAt\", \"fg_goal\"], () => {});\r\n    chrome.runtime.sendMessage({ type: \"FG_CANCEL_SESSION_END\" }).catch(() => {});\r\n\r\n    showToast(\"FocusGuard session finished. Extend, break, or stop?\", [\r\n      {\r\n        label: \"Extend\",\r\n        onClick: () => {\r\n          getSettingsRaw().then((raw) => {\r\n            const minutes = Number(raw.minutes) || 30;\r\n            const goal = (raw.goal || \"\").trim();\r\n            const profile = raw.profile || { allow: [], block: [] };\r\n\r\n            const newEnd = Date.now() + minutes * 60_000;\r\n            chrome.storage.local.set({ fg_session_endAt: newEnd, fg_goal: goal }, () => {\r\n              chrome.runtime\r\n                .sendMessage({ type: \"FG_SCHEDULE_SESSION_END\", endAt: newEnd })\r\n                .catch(() => {});\r\n              startSession(minutes, profile, Boolean(raw.consent), goal, newEnd);\r\n            });\r\n          });\r\n        },\r\n      },\r\n      { label: \"Break\", onClick: () => {} },\r\n      { label: \"Stop\", onClick: () => {} },\r\n    ]);\r\n  }\r\n});\r\n"],"names":["planChecks","durationMs","n","_","i","t","a","b","watchNavChanges","cb","opts","minInterval","pollMs","lastFire","lastURL","lastTitle","timer","now","e","waitStableDOM","timeout","resolve","settleTimer","armSettle","obs","getMeta","name","getJsonLd","scripts","parts","s","extractMinimum","title","description","jsonld","snippet","host","shadow","currentToast","ensureShadowHost","style","wrap","disposeCurrent","showToast","message","actions","root","row","msg","x","actBar","onClickWrapper","fn","dur","BACKEND","CHECK_MIN_INTERVAL_MS","running","lastCheckAt","judgeInFlight","judgeCooldownUntil","stopWatchNav","sessionEndAt","res","d","sessionActive","getSession","data","p","goal","endAt","getSettingsRaw","postViaSW","url","body","timeoutMs","to","resp","postDirect","ctrl","r","postJSON","path","viaSW","runCheck","profile","consent","norm","startSession","minutes","N","plan","t0","offset","sess","changes","area","_sender","sendResponse","raw","newEnd"],"mappings":"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"}