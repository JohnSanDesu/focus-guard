(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const t of document.querySelectorAll('link[rel="modulepreload"]'))n(t);new MutationObserver(t=>{for(const c of t)if(c.type==="childList")for(const i of c.addedNodes)i.tagName==="LINK"&&i.rel==="modulepreload"&&n(i)}).observe(document,{childList:!0,subtree:!0});function o(t){const c={};return t.integrity&&(c.integrity=t.integrity),t.referrerPolicy&&(c.referrerPolicy=t.referrerPolicy),t.crossOrigin==="use-credentials"?c.credentials="include":t.crossOrigin==="anonymous"?c.credentials="omit":c.credentials="same-origin",c}function n(t){if(t.ep)return;t.ep=!0;const c=o(t);fetch(t.href,c)}})();const I=["Mathematics","Computer Science","Data Science","Software Engineering","Research Methods","Finance Study","Economics","Health Study","Physics","Chemistry","Biology","Language Learning","Productivity","General News","Tech News","Gaming","Variety Entertainment","Short-form Social","Sports","Music"];function g(l,e){l.innerHTML="";for(const o of e){const n=document.createElement("option");n.value=o,n.textContent=o,l.appendChild(n)}}function k(l){return Array.from(l.selectedOptions).map(e=>e.value)}function C(l){return Array.from(new Set(l))}function B(l,e){const o=C(e);return{allow:C(l.filter(t=>!o.includes(t))),block:o}}async function P(){return new Promise(l=>{chrome.storage.local.get(["fg_minutes","fg_consent","fg_profile","fg_goal"],e=>{const o={};typeof e?.fg_minutes=="number"&&(o.minutes=e.fg_minutes),typeof e?.fg_consent=="boolean"&&(o.consent=e.fg_consent);const n=e?.fg_profile;n&&Array.isArray(n.allow)&&Array.isArray(n.block)&&(o.profile={allow:n.allow,block:n.block}),typeof e?.fg_goal=="string"&&(o.goal=e.fg_goal),l(o)})})}async function A(){return new Promise(l=>{chrome.storage.local.get(["fg_session_endAt"],e=>{const o=e?.fg_session_endAt;l(typeof o=="number"&&o>Date.now()?o:null)})})}function L(l){const e=Math.max(0,Math.floor(l/1e3)),o=String(Math.floor(e/60)).padStart(2,"0"),n=String(e%60).padStart(2,"0");return`${o}:${n}`}async function N(){const l=document.getElementById("fg-status"),e=document.querySelector("#fg-minutes"),o=document.querySelector("#fg-consent"),n=document.querySelector("#fg-allow"),t=document.querySelector("#fg-block"),c=document.querySelector("#fg-neutral"),i=document.querySelector("#fg-goal"),p=document.querySelector("#fg-save"),y=document.querySelector("#fg-clear"),h=document.querySelector("#fg-stop");function M(s,r){if(!Array.from(s.options).some(f=>f.value===r)){const f=document.createElement("option");f.value=r,f.textContent=r,s.appendChild(f)}}function E(s){const r=[];for(const a of Array.from(s.options))a.selected||r.push(a);s.innerHTML="";for(const a of r)s.appendChild(a)}function b(s){const r=c,a=s==="allow"?n:t,f=s==="allow"?t:n,w=Array.from(r.selectedOptions).map(d=>d.value);for(const d of w){const _=Array.from(f.options).some(v=>v.value===d);if(!(s==="allow"&&_)){if(s==="block"){const v=Array.from(n.options).find(q=>q.value===d);v&&v.remove()}M(a,d)}}}document.getElementById("fg-to-allow").addEventListener("click",()=>b("allow")),document.getElementById("fg-to-block").addEventListener("click",()=>b("block")),document.getElementById("fg-rm-allow").addEventListener("click",()=>E(n)),document.getElementById("fg-rm-block").addEventListener("click",()=>E(t)),c.addEventListener("dblclick",s=>{s.shiftKey?b("block"):b("allow")}),g(c,I);const u=await P();u?.minutes&&(e.value=String(u.minutes)),typeof u?.consent=="boolean"&&(o.checked=u.consent);const x=u?.profile?.allow??[],O=u?.profile?.block??[];g(n,x),g(t,O);let m;async function S(){const s=await A();if(s){const r=s-Date.now();l.textContent=`セッション中 — 残り ${L(r)}`,p.disabled=!0,y.disabled=!0,e.disabled=!0,o.disabled=!0,n.disabled=!0,t.disabled=!0,i.disabled=!0,h.hidden=!1,m&&clearInterval(m),m=window.setInterval(()=>{const a=s-Date.now();a<=0?(clearInterval(m),l.textContent="セッション終了",h.hidden=!0,p.disabled=!1,y.disabled=!1,e.disabled=!1,o.disabled=!1,n.disabled=!1,t.disabled=!1,i.disabled=!1):l.textContent=`セッション中 — 残り ${L(a)}`},1e3)}else l.textContent="待機中（セッション未開始）",p.disabled=!1,y.disabled=!1,e.disabled=!1,o.disabled=!1,n.disabled=!1,t.disabled=!1,i.disabled=!1,h.hidden=!0,m&&clearInterval(m)}await S(),p.onclick=async()=>{if(await A()){alert("すでにセッション中です。停止してから再度開始してください。");return}const r=Math.max(1,Math.floor(Number(e.value)||30)),a=o.checked,f=B(k(n),k(t)),w=(i.value||"").trim();if(!w){alert("Goal は必須です。");return}const d=Date.now()+r*6e4,_=w.slice(0,300);await chrome.storage.local.set({fg_minutes:r,fg_consent:a,fg_profile:f,fg_goal:_,fg_session_endAt:d});try{await chrome.runtime.sendMessage({type:"FG_FORCE_CHECK"})}catch{}window.close()},y.onclick=async()=>{await A()||(e.value="30",o.checked=!1,g(n,[]),g(t,[]),i.value="")},h.onclick=async()=>{await chrome.storage.local.set({fg_session_endAt:Date.now()}),await chrome.storage.local.remove(["fg_goal"]),await S()},chrome.storage.onChanged.addListener((s,r)=>{r==="local"&&"fg_session_endAt"in s&&S()})}N().catch(console.error);
//# sourceMappingURL=popup-BlcjhhDN.js.map
